<script lang="ts" setup>
import { ref, h } from "vue";
import type { NewQuiz } from "../../interfaces/quiz";
import { QUIZ_QUESTION_SETTINGS } from "../../utils/constants";
import { useQuizStore } from "../../stores/quiz";
import { useAuthStore } from "../../stores/auth";
import { navigateTo } from "nuxt/app";
import { ElMessageBox } from "element-plus";

const quizStore = useQuizStore();
const authStore = useAuthStore();

const selectedOption = ref("ai");

const quizSettings = ref<NewQuiz>();

const handleOptionClick = (option: string) => {
  selectedOption.value = option;
};

const handlePromptSelected = async (prompt: string) => {
  const settings: NewQuiz = {
    prompt,
    questions: QUIZ_QUESTION_SETTINGS,
  };
  quizSettings.value = settings;
  quizStore.setQuizSettings(settings);
  if (!authStore.user) {
    showLoginDialog();
    return;
  }

  await navigateTo("/create");
};

const showLoginDialog = () => {
  ElMessageBox({
    title: "Please login to continue",
    message: h("p", null, [
      h("span", null, "You need to "),
      h("i", { style: "color: teal" }, "login"),
      h("span", null, " to access this feature."),
    ]),
    confirmButtonText: "Login",
    cancelButtonText: "Cancel",
    type: "warning",
  }).then(() => {
    console.log("HERE", quizStore.quizSettings?.prompt);
    quizStore.setSavedPrompt(quizStore.quizSettings?.prompt || "");
    navigateTo("/auth/signup?redirect=/");
  });
};
</script>

<template>
  <div class="create-quiz-container">
    <span>
      Generate personalized quizzes with AI in seconds! Share with friends and compete for the top
      spotâ€”fun, fast, and interactive!
    </span>
    <CreateQuizStep2 :option="selectedOption" @onPromptSelected="handlePromptSelected" />
    <CreateQuizStep1 @onOptionClick="handleOptionClick" />
  </div>
</template>

<style scoped>
.create-quiz-container {
  display: flex;
  flex-direction: column;
  padding-top: 100px;
  width: 100%;
  margin: 0 auto;
  max-width: 800px;
}

span {
  font-size: 24px;
  font-weight: 400;
  margin: 20px;
  color: white;
  text-align: center;
  max-width: 750px;
}
</style>
